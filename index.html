<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Nikke Skills</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" />
  <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css" />
  <link rel="stylesheet" href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" />
</head>

<body class="bg-dark">
  <div class="container">
    <br />
    <h1 class="text-light">Nikke Skills</h1>
    <br />
    <br />
    <br />


    <div>
      <button class="btn btn-dark" data-bs-toggle="collapse" data-bs-target="#rarity_collapse">+稀有度</button>

      <div class="collapse show" id="rarity_collapse">
        <hr class="text-light">
        <button id="rarity_all" class="btn btn-success">All</button>
        <input id="rarity_r" type="checkbox" data-toggle="toggle" checked data-on="R" data-off="R"
          data-onstyle="success" data-offstyle="secondary" />
        <input id="rarity_sr" type="checkbox" data-toggle="toggle" checked data-on="SR" data-off="SR"
          data-onstyle="success" data-offstyle="secondary" />
        <input id="rarity_ssr" type="checkbox" data-toggle="toggle" checked data-on="SSR" data-off="SSR"
          data-onstyle="success" data-offstyle="secondary" />
      </div>
    </div>

    <table class="table-dark" data-show-columns="true" id="nikkesTable">
      <thead>
        <tr>
          <th data-field="icon"></th>
          <th class="text-center" data-field="name">
            名稱
          </th>
          <th class="text-center" data-field="rarity" data-filter-control="select">
            稀有度
          </th>
          <th class="text-center" data-field="class">
            職業
          </th>
          <th class="text-center" data-field="code">
            代碼
          </th>
          <th class="text-center" data-field="company">
            企業
          </th>
          <th class="text-center" data-field="squad">
            部隊
          </th>
          <th class="text-center" data-field="burst">
            爆裂
          </th>
          <th class="align-text-top" data-field="skill1" data-formatter="skillFormatter">
            技能1
          </th>
          <th class="align-text-top" data-field="skill2" data-formatter="skillFormatter">
            技能2
          </th>
          <th class="align-text-top" data-field="skill3" data-formatter="skillFormatter">
            技能3
          </th>
        </tr>
      </thead>
    </table>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>
  <script src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script>
  <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>

  <script type="text/javascript">
    function skillFormatter(index, row, element) {
      //  console.log(JSON.stringify(index));

      var skill = "";
      skill += "<p><b>" + index.name + "</b></p>";

      for (var i = 0; i < index.skill_content.length; i++) {
        if (index.skill_content[i][0] == "◽") {
          skill += "<p>" + index.skill_content[i] + "</p>";
        } else {
          skill += '<p  class="text-info">' + index.skill_content[i] + "</p>";
        }
      }

      return skill;
    }

    var jsonData = [];
    var search_r = true;
    var search_sr = true;
    var search_ssr = true;


    $(document).ready(function () {
      var xmlhttp = new XMLHttpRequest();

      var jsonPath =
        "https://raw.githubusercontent.com/Rekkuuza/nikkeskills.github.io/main/nikkes.json";

      xmlhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
          jsonData = JSON.parse(this.responseText);
          listNikkes(jsonData);
        }
      };

      xmlhttp.open("GET", jsonPath, true);
      xmlhttp.send();

      function listNikkes(jsonData) {
        $("#nikkesTable").bootstrapTable({
          data: jsonData,
          filterControl: true
        });
      }





      $('#rarity_all').click(function () {

        if (search_r == search_sr == search_ssr == true) return;
        if (!search_r) $('#rarity_r').bootstrapToggle('on');
        if (!search_sr) $('#rarity_sr').bootstrapToggle('on');
        if (!search_ssr) $('#rarity_ssr').bootstrapToggle('on');
        reloadTable();
      });


      $('#rarity_r').change(function () {
        search_r = !search_r;
        reloadTable();
      });
      $('#rarity_sr').change(function () {
        search_sr = !search_sr;
        reloadTable();
      });

      $('#rarity_ssr').change(function () {
        search_ssr = !search_ssr;
        reloadTable();
      });


      // get ready end
    });


    function reloadTable() {

      var filterRarity = [];
      if (search_r) filterRarity.push('R');
      if (search_sr) filterRarity.push('SR');
      if (search_ssr) filterRarity.push('SSR');


      $("#nikkesTable").bootstrapTable('filterBy',
        {
          rarity: filterRarity
        });
    }



    function showConsole() {
      console.log(
        "search_r:" +
        search_r +
        "\r\n" +
        "search_sr:" +
        search_sr +
        "\r\n" +
        "search_ssr:" +
        search_ssr
      );
    }


  </script>
</body>

</html>